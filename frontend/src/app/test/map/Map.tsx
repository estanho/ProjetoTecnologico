'use client';

import { Button } from '@nextui-org/react';
import {
  GoogleMap,
  Marker,
  DirectionsRenderer,
  Libraries,
  LoadScript,
} from '@react-google-maps/api';
import axios from 'axios';
import { useState } from 'react';
import { convertDirectionsResponseToDirectionsResult } from '../../utils/convert';

const center = { lat: -29.9487, lng: -50.9702 };

const libraries = [
  'drawing',
  'geometry',
  'localContext',
  'places',
  'visualization',
];

function App() {
  const [googleMap, setGoogleMap] = useState<google.maps.Map>();
  const [directionsResponse, setDirectionsResponse] = useState(null);
  const [coordinate, setCoordinate] = useState(center);
  const [botaoVisivel, setBotaoVisivel] = useState(true);

  async function calculateRoute() {
    const config = {
      headers: {
        Authorization: `Bearer eyJhbGciOiJIUzI1NiIsImtpZCI6IjZ4UG5UZVY1RUJTWjFVY28iLCJ0eXAiOiJKV1QifQ.eyJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNjk5NDEwOTEyLCJpYXQiOjE2OTk0MDczMTIsImlzcyI6Imh0dHBzOi8vamNicnpqaGRwdG5zYmtybnd5b20uc3VwYWJhc2UuY28vYXV0aC92MSIsInN1YiI6ImQ3ZDZkMWIzLTMyMTEtNDhhMy04MmYyLWQyYjAxOGI1MjYyZCIsImVtYWlsIjoiZXN0YW5ob2V1QGdtYWlsLmNvbSIsInBob25lIjoiIiwiYXBwX21ldGFkYXRhIjp7InByb3ZpZGVyIjoiZW1haWwiLCJwcm92aWRlcnMiOlsiZW1haWwiLCJnb29nbGUiXX0sInVzZXJfbWV0YWRhdGEiOnsiZW1haWwiOiJlc3RhbmhvZXVAZ21haWwuY29tIn0sInJvbGUiOiJhdXRoZW50aWNhdGVkIiwiYWFsIjoiYWFsMSIsImFtciI6W3sibWV0aG9kIjoicGFzc3dvcmQiLCJ0aW1lc3RhbXAiOjE2OTk0MDczMTJ9XSwic2Vzc2lvbl9pZCI6IjM1OTcwMGYzLTQyYTMtNDc5NC1hMDhjLWEzMDk5YzY1ZmUzMiJ9.fFJ89-caq-4a1NAd-aYH9H1a1WN532Ty76INqbfa7ws`,
      },
    };

    const { data: results } = await axios.get(
      'http://localhost:3001/trips',
      config,
    );

    console.log(results);

    setDirectionsResponse(
      // @ts-ignore
      convertDirectionsResponseToDirectionsResult(
        results.morningGoingTrip.directions,
      ),
    );

    setBotaoVisivel(false);
  }

  return (
    <div className="relative h-full">
      <div className="h-full">
        <LoadScript
          googleMapsApiKey={
            process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY as string
          }
          libraries={libraries as Libraries}
        >
          <GoogleMap
            onLoad={(map) => {
              setGoogleMap(map);
            }}
            mapContainerStyle={{ width: '100%', height: '100%' }}
            zoom={17}
            center={center}
            options={{
              zoomControl: false,
              streetViewControl: false,
              mapTypeControl: false,
              fullscreenControl: false,
              styles: [
                {
                  elementType: 'labels',
                  featureType: 'poi.business',
                  stylers: [{ visibility: 'off' }],
                },
              ],
            }}
          >
            {/* pin */}
            {googleMap && (
              <Marker
                position={coordinate}
                icon={{
                  path: 'M31.9756 91.4607C31.8952 93.5743 31.4447 95.5879 29.8096 97.048C29.2338 97.5621 28.3407 97.8355 27.55 97.9715C25.6779 98.2935 23.7803 98.4673 21.8632 98.7672C18.8854 98.8333 15.9375 98.8333 12.9115 98.8333C11.9883 98.7222 11.1393 98.6352 10.2992 98.4945C8.91384 98.2625 7.53293 98.0031 6.15277 97.7415C4.96343 97.516 4.25318 96.7189 3.75818 95.6802C3.12467 94.3509 2.65184 92.9796 2.7301 91.4334C3.13023 91.7184 3.46928 92.0512 3.81356 92.4493C3.79087 93.4804 4.30886 94.1877 4.96569 94.794C6.32761 96.0512 7.99185 96.5112 9.84533 96.5787C10.2649 96.7248 10.6455 96.8223 11.0261 96.9197C11.044 96.8723 11.062 96.8249 11.08 96.7775C10.9335 96.6478 10.787 96.5182 10.6495 96.3313C10.661 96.2356 10.6634 96.1971 10.7371 96.1534C12.6495 96.3818 14.4907 96.6153 16.3334 96.893C16.3383 96.9665 16.3417 96.9958 16.3623 97.0668C16.4393 97.1731 16.4991 97.2378 16.4783 97.3139C15.8598 97.3009 15.3218 97.2763 14.7441 97.222C14.5406 97.2138 14.3768 97.2355 14.213 97.2571C14.2053 97.3285 14.1976 97.4 14.1898 97.4714C14.4185 97.5296 14.6472 97.5878 14.9514 97.6438C17.1669 97.5858 19.307 97.5302 21.5022 97.4792C21.5823 97.3742 21.6074 97.2645 21.5925 97.1106C20.3979 97.1186 19.2433 97.1708 18.1373 97.1744C18.1979 97.0815 18.21 97.0373 18.2502 96.9705C18.31 96.9095 18.3281 96.8656 18.3988 96.7954C20.3043 96.5947 22.1436 96.4147 24.0631 96.2269C23.9189 96.4433 23.8138 96.601 23.5624 96.9783C24.153 96.7859 24.5043 96.6715 24.9266 96.547C26.0662 96.3048 27.2028 96.2299 28.1871 95.8034C29.636 95.1756 30.8574 94.2059 30.9131 92.3512C31.3009 92.039 31.6383 91.7498 31.9756 91.4607ZM12.8914 97.3968C13.0512 97.4207 13.2111 97.4445 13.4693 97.483C13.028 96.9379 13.028 96.9379 12.8914 97.3968ZM12.2753 96.937C12.1155 96.9129 11.9556 96.8887 11.6963 96.8496C12.1408 97.3945 12.1408 97.3945 12.2753 96.937ZM22.3115 97.1225C22.4535 97.0847 22.5955 97.0469 22.7376 97.0091C22.7076 96.9394 22.6776 96.8696 22.6477 96.7999C22.5118 96.8817 22.3759 96.9635 22.3115 97.1225Z M34.8333 80.0938C34.1412 80.8637 33.2505 81.0629 32.1909 81.1399C31.6626 81.1456 31.2658 81.1794 30.8691 81.2131C30.8691 80.8808 30.3412 79.4095 30.3412 79.4095H31.6863H32.1909C33.0253 79.2438 33.857 79.1652 34.7624 78.9998C34.8333 79.3403 34.8333 79.6806 34.8333 80.0938Z M2.48781 81.1727C1.55813 81.0629 0.629744 80.9497 -0.109943 80.182C-0.166599 79.8264 -0.166598 79.4861 -0.166598 79.0729C0.672205 79.1652 1.51101 79.3303 2.45292 79.5454C2.72899 79.6116 2.90195 79.6278 3.05905 79.6426C3.04674 79.9111 3.03877 79.3009 3.05905 79.6426H4.27731C4.19167 79.9757 3.88376 80.2312 3.90725 80.5339C3.96581 81.2883 3.69721 81.4383 3.0409 81.2234C2.86939 81.1672 2.67285 81.1875 2.48781 81.1727Z M2.4926 81.2502C2.67281 81.1875 2.86935 81.1672 3.04086 81.2234C3.69717 81.4383 3.96577 81.2883 3.90721 80.5339C3.88371 80.2312 4.23525 79.9176 4.3209 79.5845C4.50665 78.8622 4.64794 78.127 4.77775 77.3918C5.48972 73.3594 5.70154 69.2958 5.50902 65.2089C5.49653 64.9439 5.43582 64.6812 5.39602 64.4069C4.38725 64.3739 3.84597 64.7954 3.76619 65.7225C3.63316 67.2685 3.50129 68.8153 3.41573 70.3644C3.26118 73.1623 3.13878 75.9621 3.01048 78.7614C2.99817 79.03 3.03873 79.3009 3.05901 79.6426C2.9019 79.6278 2.72894 79.6116 2.51855 79.5448C2.48746 74.4992 2.49845 69.5043 2.49932 64.5094C2.50278 44.6676 2.50307 24.8257 2.51579 4.90664L3.47692 2.33339L5.52538 1.29275C9.50002 0.250054 24.2871 0.100421 29.2178 1.28416L31.115 2.33339L32.059 4.89555C32.1457 5.30747 32.1653 5.72329 32.1654 6.13912C32.1682 30.5399 32.1695 54.9407 32.1795 79.419C31.849 79.774 31.6741 79.7594 31.6524 79.256C31.4986 75.6827 31.3343 72.1099 31.1641 68.5373C31.1246 67.7069 31.0828 66.8742 30.9833 66.0496C30.8362 64.8301 30.6307 64.6382 29.3308 64.3651C29.2738 64.6499 29.1802 64.9319 29.1658 65.2178C28.933 69.8346 29.2737 74.4115 30.1886 78.9415C30.2834 79.4111 30.5678 79.8423 30.8691 80.2162C30.8691 80.5485 30.8691 80.8808 30.8691 81.2131C31.2658 81.1794 31.6626 81.1456 32.122 81.1431C32.122 84.5566 32.0594 87.9388 31.9862 91.3909C31.6383 91.7499 31.3009 92.039 30.886 92.2963C30.2278 91.4147 29.1109 91.0926 28.1894 91.6951C26.4318 92.8443 25.3561 94.5173 24.8556 96.557C24.5043 96.6715 24.153 96.7859 23.5624 96.9783C23.8138 96.601 23.9189 96.4433 24.0631 96.2269C22.1436 96.4148 20.3043 96.5948 18.3337 96.792C18.1596 96.8165 18.1167 96.8238 18.0351 96.8301C17.9963 96.829 17.9274 96.7932 17.9268 96.7853C17.9261 96.7774 17.9428 96.7943 17.8637 96.8056C17.3665 96.8225 16.9482 96.8281 16.4801 96.8331C16.3975 96.8379 16.3647 96.8434 16.3319 96.8489C14.4907 96.6153 12.6495 96.3818 10.6892 96.1552C10.5935 96.2375 10.617 96.313 10.6404 96.3885C10.787 96.5182 10.9335 96.6479 11.08 96.7776C11.062 96.825 11.044 96.8723 11.0261 96.9197C10.6455 96.8223 10.2649 96.7248 9.86635 96.5156C9.2519 94.6086 8.32216 93.0234 6.78842 91.8784C5.70104 91.0666 4.42826 91.3216 3.80832 92.384C3.46927 92.0512 3.13023 91.7184 2.74223 91.36C2.62801 87.9988 2.56273 84.6633 2.4926 81.2502ZM6.00117 64.4423C5.99644 66.3302 5.99951 68.2182 5.9852 70.106C5.96285 73.0516 5.72684 75.9688 5.06689 78.8555C4.74778 80.2514 4.56795 81.6988 4.51208 83.1302C4.43659 85.0639 5.10148 85.822 6.98594 86.3075C10.3318 87.1695 13.7343 87.6311 17.1885 87.6457C20.8953 87.6614 24.5475 87.2209 28.1159 86.1804C29.2574 85.8476 30.0444 85.1598 30.1341 83.9269C30.1942 83.1023 30.1994 82.253 30.072 81.4394C29.6477 78.7297 29.154 76.0308 28.6802 73.3289C28.6525 73.1708 28.5657 73.023 28.5064 72.8704C28.4621 72.8822 28.4177 72.894 28.3734 72.9058C28.3734 73.3333 28.3734 73.7609 28.3734 74.2117C21.0097 75.3827 13.6766 75.3816 6.2595 74.1875C6.2595 70.631 6.2595 67.0735 6.2595 63.5161C6.18722 63.5148 6.11494 63.5135 6.04266 63.5122C6.02904 63.7688 6.01542 64.0254 6.00117 64.4423ZM5.91408 61.2796C5.99437 60.8224 6.14295 60.3654 6.14446 59.908C6.16115 54.854 6.15511 49.7999 6.15502 44.7458C6.15483 33.47 6.15524 22.1942 6.15047 10.9184C6.15035 10.6164 6.13478 10.3029 6.0549 10.0146C5.87835 9.37717 5.40629 9.03055 4.76636 9.02739C4.12744 9.02425 3.63941 9.356 3.47692 10.0026C3.38384 10.3729 3.36115 10.7689 3.36066 11.1534C3.34383 24.3701 3.33083 37.5867 3.32407 50.8034C3.32246 53.9355 3.34464 57.0677 3.35639 60.1998C3.35892 60.8754 3.51154 61.5015 4.19332 61.7879C4.80904 62.0466 5.39097 61.9313 5.91408 61.2796ZM31.1262 19.0834C31.1262 17.501 31.1265 15.9187 31.1261 14.3363C31.1258 13.1426 31.1515 11.948 31.115 10.7554C31.0863 9.82031 30.4809 9.19037 29.7153 9.19839C28.9294 9.20662 28.3738 9.83903 28.3346 10.7753C28.3265 10.9693 28.3326 11.1639 28.3326 11.3583C28.3317 18.2686 28.3305 25.1789 28.3302 32.0892C28.3298 41.4284 28.329 50.7675 28.3315 60.1067C28.3318 61.2574 28.8404 61.9149 29.7125 61.9264C30.5797 61.9377 31.103 61.2739 31.1257 60.1309C31.1296 59.9367 31.1266 59.7423 31.1266 59.5479C31.1265 56.1908 31.1264 52.8337 31.1263 49.4766C31.1262 39.4011 31.1262 29.3256 31.1262 19.0834ZM8.78148 5.35692C8.47811 5.38493 8.16932 5.3861 7.87238 5.44601C6.99911 5.62218 6.72609 6.01942 6.80653 6.91518C6.88575 7.7973 7.57549 7.49424 8.01802 7.48025C10.1517 7.41276 12.2843 7.18419 14.4158 7.20137C18.5733 7.23487 22.7296 7.40355 26.8871 7.48232C27.2041 7.48832 27.7474 7.28533 27.803 7.0773C27.9483 6.53332 27.9865 5.88134 27.2675 5.60402C26.987 5.49583 26.6819 5.41506 26.3833 5.396C24.2528 5.25996 22.1205 5.03227 19.9899 5.04479C16.3047 5.06647 12.6203 5.24093 8.78148 5.35692ZM2.77975 65.8317C2.9107 66.0001 3.04164 66.1684 3.17259 66.3367C3.28147 66.1463 3.49991 65.9412 3.47682 65.7684C3.42606 65.3885 3.25323 65.0248 3.13023 64.6546C3.00574 65.003 2.88126 65.3515 2.77975 65.8317ZM31.8868 65.1677C31.7562 64.9987 31.6255 64.8298 31.4949 64.6608C31.3857 64.8512 31.167 65.0561 31.1899 65.229C31.2403 65.6097 31.4128 65.9742 31.5355 66.3453C31.6603 65.9967 31.785 65.6482 31.8868 65.1677Z',
                  fillColor: '#e8c70e',
                  fillOpacity: 1,
                  rotation: 0,
                  scale: 0.5,
                  anchor: new google.maps.Point(17, 52),
                }}
                options={{ map: googleMap }}
              />
            )}
            {directionsResponse && (
              <DirectionsRenderer
                directions={directionsResponse}
                options={{
                  markerOptions: {
                    /*
                    icon: {
                      path: require('./pin.png'),
                    },*/
                  },
                }}
              />
            )}
          </GoogleMap>
        </LoadScript>
        {botaoVisivel && (
          <Button
            className="absolute top-20 left-8 transform -translate-x-1/2 -translate-y-1/2"
            onClick={calculateRoute}
          ></Button>
        )}
      </div>
    </div>
  );
}

export default App;
